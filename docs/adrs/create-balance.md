# ADR

# Demo-счёт

## Статус

Предложение

## Контекст

Отправка инвестором запроса на получение информации по своему счёту.

Пополнение Счета Инвестора.

## Решение

Добавить логин в запросы, чтобы работать с данными конкретного инвестора.

Вывод данных по счёту - только сумма.

Архитектура
Создание микросервиса баланса с использованием шаблонов.
[Identity и простой шаблоны](https://github.com/Calabonga/Microservice-Template/tree/master/AspNetCore%20v6.0/MinimalAPI)

--Общение фасада и сервиса.--
Фасад (producer) отправляет информацию в топик("facade-balance"), затем микросервис баланса получает эти данные, обрабатывает их и отправляет ответ в топик ("balance-facade"), фасад принимает данные.
https://drive.google.com/file/d/1-FORkZrkF7YSUjpRjvqxH5qaYkbVSzWn/view?usp=sharing

--Отправка инвестором запроса на получение информации по своему счёту.--
Фасад отправляет токен в аутентификационный сервис на проверку подлинности. При подтвержении токена фасад достаёт из него логин и отправляет сообщение в кафку (топик "balance"). Микросервис баланса получает команду и ищет данные по логину, после чего происходит отправка данных о его балансе в кафку, фасад из кафки получает данные и перекидывает их клиенту.

--Пополнение Счета Инвестора.--
Фасад отправляет токен в аутентификационный сервис на проверку подлинности. При подтвержении токена фасад отправляет сообщение {логин, сумма_пополнения} в кафку (топик "replenishment").
Микросервис баланса получает команду и ищет логин инвестора, если нет в таблице информации о балансе, то вносится новая запись с данной суммой, если же есть информация, то происходит update. Далее отправляется информация об общей сумме инвестора на счету в кафку. После чего возвращается ответ на клиент.

## Последствия

Не нужно будет работать со всеми данными из бд, а только с данными конкретного инвестора.

Простое получение нужной информации.
